<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<META HTTP-EQUIV="Pragma" CONTENT="no-cache">
@if?!Authenticate@ @AddFile?/grinder/failedlogin.cmvp@ @else@
@if?!CheckAuthCode?AUTH_CMDQUESTS=true&SYSOP=true@ @AddFile?/grinder/nopriv.cmvp@ @else@

<html>
<head>
	<title>Browsing: @RequestParameter?PATH@</title>
	<script language=JavaScript>
	<!--
		function OpenFile(action)
		{
			var strFeatures="top=0,left=75,resizeable=no,scrollbars=yes,height=600,width=750,alwaysRaised=yes,dependent=yes";
			w=window.open("browsefile.cmvp?"+action,"Filer",strFeatures, false);
		}
		function NewDir(named)
		{
			var path=document.BROWSE.PATH.value;
			if((path.length>0)&&(path.lastIndexOf('/')!=path.length-1))
				path=path+'/';
			document.BROWSE.PATH.value=path+named+"/";
			document.BROWSE.submit();
		}
		function CreateDir(named)
		{
			var named=prompt('Enter new directory name:','');
			if(named=='') return;
			document.BROWSE.FUNCTION.value="NEWDIR";
			var path=document.BROWSE.PATH.value;
			if((path.length>0)&&(path.lastIndexOf('/')!=path.length-1))
				path=path+'/';
			document.BROWSE.PATH.value=path+named+"/";
			document.BROWSE.submit();
		}
		function NewFile(action)
		{
			OpenFile(action);
		}
		function BackDir()
		{
			var l=document.BROWSE.PATH.value.length;
			if(l>1)
			{
				var x=document.BROWSE.PATH.value.substring(0,l-1).lastIndexOf('/');
				if(x>=0)
					document.BROWSE.PATH.value=document.BROWSE.PATH.value.substring(0,x+1);
				else
					return;
			}
			document.BROWSE.submit();			
		}
	//-->
	</script>
</head>
<body BGCOLOR=BLACK>
<FORM NAME=BROWSE TARGET=_top METHOD=POST ACTION="browse.cmvp">
<INPUT TYPE=HIDDEN NAME=AUTH VALUE="@Authenticate?AUTH@">
<INPUT TYPE=HIDDEN NAME=PATH VALUE="@RequestParameter?PATH@">
<INPUT TYPE=HIDDEN NAME=FUNCTION VALUE="">
@if?CheckReqParm?FUNCTION=NEWDIR@<FONT COLOR=RED>@FileMgr?CREATEDIR@</FONT><BR>@endif@
@if?CheckReqParm?FUNCTION=UPLOAD@<FONT COLOR=RED>@FileMgr?UPLOAD@</FONT><BR>@endif@
@if?CheckReqParm?FUNCTION=SEARCH@<FONT COLOR=RED>@FileMgr?SEARCH&STR=@@RequestParameter?SEARCHSTR@@ @</FONT><BR>@endif@
@if?CheckReqParm?FUNCTION=NAMESEARCH@<FONT COLOR=RED>@FileMgr?NAMESEARCH&STR=@@RequestParameter?SEARCHSTR@@ @</FONT><BR>@endif@
<a href="javascript:CreateDir();"><FONT COLOR=YELLOW>*create new dir*</FONT></a><P>
<a href="javascript:BackDir()"><FONT COLOR=YELLOW>..</FONT></a><BR>
@FileNext?RESET@
@loop@
@FileNext@
	@if?FileInfo?ISDIRECTORY@
		<a href="javascript:NewDir('@RequestParameter?FILE@')"  style="text-decoration:none">
		@if?FileInfo?ISVFS@<I>@endif@ 	@if?FileInfo?ISBOTH@<B>@endif@
		<FONT COLOR=YELLOW>@RequestParameter?FILE@</FONT>
		@if?FileInfo?ISVFS@</I>@endif@ 	@if?FileInfo?ISBOTH@</B>@endif@
		</a>
	<BR>
	@endif@
@back@
@FileNext?RESET@
@loop@
@FileNext@
	@if?!FileInfo?ISDIRECTORY@ @if?FileInfo?ISFILE@
	<a href="javascript:OpenFile('@RequestParametersEncoded@')"  style="text-decoration:none">
	@if?FileInfo?ISVFS@<I>@endif@ 	@if?FileInfo?ISBOTH@<B>@endif@
		<FONT COLOR=WHITE>@RequestParameter?FILE@</FONT>
	@if?FileInfo?ISVFS@</I>@endif@ 	@if?FileInfo?ISBOTH@</B>@endif@
	</a>
	<BR>
	@endif@ @endif@
@back@
<a href="javascript:NewFile('@RequestParametersEncoded@');"><FONT COLOR=AQUA>*create new file*</FONT></a><BR>
</FORM>
<HR>
<FORM NAME=UPLOAD TARGET=_top ENCTYPE="multipart/form-data" ACTION=browse.cmvp METHOD=POST>
<FONT COLOR=CYAN>*search for filenames (reg. exp.)*</FONT>
<INPUT TYPE=HIDDEN NAME=AUTH VALUE="@Authenticate?AUTH@">
<INPUT TYPE=HIDDEN NAME=PATH VALUE="@RequestParameter?PATH@">
<INPUT TYPE=HIDDEN NAME=FUNCTION VALUE="NAMESEARCH">
<INPUT TYPE=TEXT NAME=SEARCHSTR VALUE="" SIZE=30><BR>
<INPUT TYPE=SUBMIT NAME=SUBMIT VALUE=SUBMIT>
</FORM>
<HR>
<FORM NAME=UPLOAD TARGET=_top ENCTYPE="multipart/form-data" ACTION=browse.cmvp METHOD=POST>
<FONT COLOR=CYAN>*search inside files (reg. exp.)*</FONT>
<INPUT TYPE=HIDDEN NAME=AUTH VALUE="@Authenticate?AUTH@">
<INPUT TYPE=HIDDEN NAME=PATH VALUE="@RequestParameter?PATH@">
<INPUT TYPE=HIDDEN NAME=FUNCTION VALUE="SEARCH">
<INPUT TYPE=TEXT NAME=SEARCHSTR VALUE="" SIZE=30><BR>
<INPUT TYPE=SUBMIT NAME=SUBMIT VALUE=SUBMIT>
</FORM>
<HR>
<FORM NAME=UPLOAD TARGET=_top ENCTYPE="multipart/form-data" ACTION=browse.cmvp METHOD=POST>
<FONT COLOR=CYAN>*upload a file*</FONT>
<INPUT TYPE=HIDDEN NAME=AUTH VALUE="@Authenticate?AUTH@">
<INPUT TYPE=HIDDEN NAME=PATH VALUE="@RequestParameter?PATH@">
<INPUT TYPE=HIDDEN NAME=FUNCTION VALUE="UPLOAD">
<INPUT TYPE=FILE NAME=FILE><BR>
<INPUT TYPE=SUBMIT NAME=SUBMIT VALUE=SUBMIT>
</FORM>
</BODY>
</HTML>
@endif@
@endif@
